<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 600" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrow-light" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#9e9e9e"/>
    </marker>
    <marker id="arrow-dark" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#666"/>
    </marker>
  </defs>
  <style>
    .title { font-size: 11px; font-weight: 600; fill: #1a1a1a; }
    .label { font-size: 10px; fill: #555; }
    .code { font-size: 10px; fill: #1a1a1a; font-family: "SFMono-Regular", "Consolas", "Liberation Mono", monospace; }
    .box { fill: #f5f5f5; stroke: #ccc; stroke-width: 1; rx: 8; }
    .box-accent { fill: #f5f5f5; stroke: #009485; stroke-width: 1.5; rx: 8; }
    .diamond { fill: #f5f5f5; stroke: #ccc; stroke-width: 1; }
    .heading { font-size: 13px; font-weight: 700; fill: #009485; }
    .connector { stroke: #9e9e9e; stroke-width: 1.2; fill: none; marker-end: url(#arrow-light); }
    .connector-no-arrow { stroke: #9e9e9e; stroke-width: 1.2; fill: none; }
    .divider { stroke: #ccc; stroke-width: 1; stroke-dasharray: 4,3; }
    .section-rule { stroke: #009485; stroke-width: 1; opacity: 0.3; }

    @media (prefers-color-scheme: dark) {
      .title { fill: #e0e0e0; }
      .label { fill: #aaa; }
      .code { fill: #e0e0e0; }
      .box { fill: rgba(255,255,255,0.07); stroke: rgba(255,255,255,0.15); }
      .box-accent { fill: rgba(255,255,255,0.07); stroke: #4db6ac; }
      .diamond { fill: rgba(255,255,255,0.07); stroke: rgba(255,255,255,0.15); }
      .heading { fill: #4db6ac; }
      .connector { stroke: #666; marker-end: url(#arrow-dark); }
      .connector-no-arrow { stroke: #666; }
      .divider { stroke: rgba(255,255,255,0.15); }
      .section-rule { stroke: #4db6ac; }
    }
  </style>

  <!-- ==================== TOP SECTION: Query Execution Path ==================== -->
  <text x="350" y="22" text-anchor="middle" class="heading">Query Execution Path</text>
  <line x1="210" y1="27" x2="490" y2="27" class="section-rule"/>

  <!-- Step 1: Client -->
  <rect x="128" y="40" width="144" height="32" class="box-accent"/>
  <text x="200" y="61" text-anchor="middle" class="title">Client sends query</text>

  <!-- Arrow: Client to Parser -->
  <line x1="200" y1="72" x2="200" y2="90" class="connector"/>

  <!-- Step 2: Parser -->
  <rect x="128" y="92" width="144" height="32" class="box"/>
  <text x="200" y="108" text-anchor="middle" class="title">Parser</text>
  <text x="200" y="120" text-anchor="middle" class="label">(syntax check)</text>

  <!-- Arrow: Parser to Optimizer -->
  <line x1="200" y1="124" x2="200" y2="142" class="connector"/>

  <!-- Step 3: Optimizer -->
  <rect x="128" y="144" width="144" height="32" class="box-accent"/>
  <text x="200" y="165" text-anchor="middle" class="title">Optimizer</text>

  <!-- Optimizer branch lines (right side) -->
  <line x1="272" y1="160" x2="320" y2="160" class="connector-no-arrow"/>
  <!-- Vertical line spanning all four check items -->
  <line x1="320" y1="130" x2="320" y2="195" class="connector-no-arrow"/>

  <!-- Branch 1: Table stats -->
  <line x1="320" y1="133" x2="350" y2="133" class="connector"/>
  <rect x="352" y="120" width="118" height="26" class="box"/>
  <text x="411" y="137" text-anchor="middle" class="label">Table statistics</text>

  <!-- Branch 2: Available indexes -->
  <line x1="320" y1="155" x2="350" y2="155" class="connector"/>
  <rect x="352" y="142" width="118" height="26" class="box"/>
  <text x="411" y="159" text-anchor="middle" class="label">Available indexes</text>

  <!-- Branch 3: Join order -->
  <line x1="320" y1="177" x2="350" y2="177" class="connector"/>
  <rect x="352" y="164" width="118" height="26" class="box"/>
  <text x="411" y="181" text-anchor="middle" class="label">Join order</text>

  <!-- Branch 4: Query cost estimates -->
  <line x1="320" y1="195" x2="350" y2="195" class="connector"/>
  <rect x="352" y="184" width="144" height="26" class="box"/>
  <text x="424" y="201" text-anchor="middle" class="label">Query cost estimates</text>

  <!-- Arrow: Optimizer to Storage Engine -->
  <line x1="200" y1="176" x2="200" y2="218" class="connector"/>

  <!-- Step 4: Storage Engine -->
  <rect x="108" y="220" width="184" height="32" class="box"/>
  <text x="200" y="237" text-anchor="middle" class="title">Storage Engine</text>
  <text x="200" y="248" text-anchor="middle" class="label">(InnoDB / MyISAM)</text>

  <!-- Arrow: Storage Engine to Return results -->
  <line x1="200" y1="252" x2="200" y2="270" class="connector"/>

  <!-- Step 5: Return results -->
  <rect x="128" y="272" width="144" height="32" class="box-accent"/>
  <text x="200" y="293" text-anchor="middle" class="title">Return results</text>

  <!-- ==================== SEPARATOR ==================== -->
  <line x1="30" y1="322" x2="670" y2="322" class="divider"/>

  <!-- ==================== BOTTOM SECTION: Index Selection Decision ==================== -->
  <text x="350" y="348" text-anchor="middle" class="heading">Index Selection Decision</text>
  <line x1="210" y1="353" x2="490" y2="353" class="section-rule"/>

  <!-- Diamond 1: Covering index? -->
  <polygon points="145,385 250,410 145,435 40,410" class="diamond"/>
  <text x="145" y="407" text-anchor="middle" class="label">Covering index</text>
  <text x="145" y="418" text-anchor="middle" class="label">exists?</text>

  <!-- Yes from Diamond 1 (right) -->
  <line x1="250" y1="410" x2="305" y2="410" class="connector"/>
  <text x="270" y="404" class="label">Yes</text>

  <!-- Index-only scan result -->
  <rect x="307" y="394" width="160" height="32" class="box-accent"/>
  <text x="387" y="410" text-anchor="middle" class="title">Index-only scan</text>
  <text x="387" y="422" text-anchor="middle" class="label">(fastest)</text>

  <!-- No from Diamond 1 (down) -->
  <line x1="145" y1="435" x2="145" y2="450" class="connector"/>
  <text x="157" y="446" class="label">No</text>

  <!-- Diamond 2: WHERE clause match? -->
  <polygon points="145,450 258,475 145,500 32,475" class="diamond"/>
  <text x="145" y="472" text-anchor="middle" class="label">Index matches</text>
  <text x="145" y="483" text-anchor="middle" class="label">WHERE clause?</text>

  <!-- Yes from Diamond 2 (right) -->
  <line x1="258" y1="475" x2="305" y2="475" class="connector"/>
  <text x="272" y="469" class="label">Yes</text>

  <!-- Index range scan result -->
  <rect x="307" y="459" width="160" height="32" class="box-accent"/>
  <text x="387" y="480" text-anchor="middle" class="title">Index range scan</text>

  <!-- No from Diamond 2 (down) -->
  <line x1="145" y1="500" x2="145" y2="515" class="connector"/>
  <text x="157" y="511" class="label">No</text>

  <!-- Diamond 3: Join columns match? -->
  <polygon points="145,515 258,540 145,565 32,540" class="diamond"/>
  <text x="145" y="537" text-anchor="middle" class="label">Index matches</text>
  <text x="145" y="548" text-anchor="middle" class="label">join columns?</text>

  <!-- Yes from Diamond 3 (right) -->
  <line x1="258" y1="540" x2="305" y2="540" class="connector"/>
  <text x="272" y="534" class="label">Yes</text>

  <!-- Index lookup result -->
  <rect x="307" y="524" width="160" height="32" class="box-accent"/>
  <text x="387" y="545" text-anchor="middle" class="title">Index lookup</text>

  <!-- No from Diamond 3 (down then right to Full table scan) -->
  <polyline points="145,565 145,575 307,575" class="connector"/>
  <text x="157" y="573" class="label">No</text>

  <!-- Full table scan result -->
  <rect x="307" y="561" width="160" height="32" class="box"/>
  <text x="387" y="577" text-anchor="middle" class="title">Full table scan</text>
  <text x="387" y="589" text-anchor="middle" class="label">(slowest)</text>
</svg>