<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 520" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrow-light" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#9e9e9e"/>
    </marker>
    <marker id="arrow-dark" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#666"/>
    </marker>
  </defs>
  <style>
    /* Light mode */
    .title { font-size: 11px; font-weight: 600; fill: #1a1a1a; }
    .label { font-size: 10px; fill: #555; }
    .code { font-size: 10px; fill: #1a1a1a; font-family: "SFMono-Regular", "Consolas", "Liberation Mono", monospace; }
    .code-muted { font-size: 9.5px; fill: #555; font-family: "SFMono-Regular", "Consolas", "Liberation Mono", monospace; }
    .box { fill: #f5f5f5; stroke: #ccc; stroke-width: 1; rx: 8; }
    .box-accent { fill: #f5f5f5; stroke: #009485; stroke-width: 1.5; rx: 8; }
    .diamond { fill: #f5f5f5; stroke: #ccc; stroke-width: 1; }
    .result { fill: #fafafa; stroke: #ddd; stroke-width: 1; rx: 6; }
    .connector { stroke: #9e9e9e; stroke-width: 1.2; fill: none; marker-end: url(#arrow-light); }
    .heading { font-size: 13px; font-weight: 700; fill: #009485; }
    .result-title { font-size: 9px; font-weight: 600; fill: #009485; text-transform: uppercase; letter-spacing: 0.05em; }

    @media (prefers-color-scheme: dark) {
      .title { fill: #e0e0e0; }
      .label { fill: #aaa; }
      .code { fill: #e0e0e0; }
      .code-muted { fill: #aaa; }
      .box { fill: rgba(255,255,255,0.07); stroke: rgba(255,255,255,0.15); }
      .box-accent { fill: rgba(255,255,255,0.07); stroke: #4db6ac; }
      .diamond { fill: rgba(255,255,255,0.07); stroke: rgba(255,255,255,0.15); }
      .result { fill: rgba(255,255,255,0.04); stroke: rgba(255,255,255,0.1); }
      .connector { stroke: #666; marker-end: url(#arrow-dark); }
      .heading { fill: #4db6ac; }
      .result-title { fill: #4db6ac; }
    }
  </style>

  <!-- TOP: Expression Evaluated -->
  <rect x="270" y="16" width="180" height="40" class="box"/>
  <text x="360" y="41" text-anchor="middle" class="title">Expression Evaluated</text>

  <!-- Arrow down to decision -->
  <line x1="360" y1="56" x2="360" y2="88" class="connector"/>

  <!-- DECISION: Diamond -->
  <g transform="translate(360, 128)">
    <rect x="-60" y="-40" width="120" height="80" rx="0" transform="rotate(45)" class="diamond"/>
    <text x="0" y="-6" text-anchor="middle" class="title">What expects</text>
    <text x="0" y="10" text-anchor="middle" class="title">the value?</text>
  </g>

  <!-- THREE BRANCHES -->

  <!-- LEFT: Scalar Context -->
  <line x1="300" y1="155" x2="140" y2="248" class="connector"/>
  <text x="190" y="190" text-anchor="middle" class="label" transform="rotate(-25, 190, 190)">$scalar = ...</text>

  <!-- Labels for other scalar triggers -->
  <text x="254" y="220" text-anchor="end" class="label">+ - * /</text>
  <text x="264" y="236" text-anchor="end" class="label">. x</text>

  <rect x="50" y="250" width="180" height="40" class="box-accent"/>
  <text x="140" y="275" text-anchor="middle" class="heading">Scalar Context</text>

  <!-- Arrow to result -->
  <line x1="140" y1="290" x2="140" y2="330" class="connector"/>

  <!-- Result box -->
  <rect x="30" y="332" width="220" height="80" class="result"/>
  <text x="140" y="350" text-anchor="middle" class="result-title">Behavior</text>
  <text x="140" y="370" text-anchor="middle" class="code">@array</text>
  <text x="140" y="384" text-anchor="middle" class="code-muted">returns element count</text>
  <text x="140" y="400" text-anchor="middle" class="code">%hash</text>
  <text x="140" y="414" text-anchor="middle" class="code-muted">returns "used/total"</text>

  <!-- CENTER: List Context -->
  <line x1="360" y1="168" x2="360" y2="248" class="connector"/>
  <text x="370" y="218" class="label">@array = ...</text>
  <text x="370" y="234" class="label">print args</text>

  <rect x="270" y="250" width="180" height="40" class="box-accent"/>
  <text x="360" y="275" text-anchor="middle" class="heading">List Context</text>

  <!-- Arrow to result -->
  <line x1="360" y1="290" x2="360" y2="330" class="connector"/>

  <!-- Result box -->
  <rect x="250" y="332" width="220" height="80" class="result"/>
  <text x="360" y="350" text-anchor="middle" class="result-title">Behavior</text>
  <text x="360" y="370" text-anchor="middle" class="code">@array</text>
  <text x="360" y="384" text-anchor="middle" class="code-muted">returns all elements</text>
  <text x="360" y="400" text-anchor="middle" class="code">$scalar</text>
  <text x="360" y="414" text-anchor="middle" class="code-muted">becomes single-element list</text>

  <!-- RIGHT: Boolean Context -->
  <line x1="420" y1="155" x2="580" y2="248" class="connector"/>
  <text x="530" y="200" text-anchor="middle" class="label" transform="rotate(25, 530, 200)">if / while</text>

  <rect x="490" y="250" width="180" height="40" class="box-accent"/>
  <text x="580" y="275" text-anchor="middle" class="heading">Boolean Context</text>

  <!-- Arrow to result -->
  <line x1="580" y1="290" x2="580" y2="330" class="connector"/>

  <!-- Result box -->
  <rect x="480" y="332" width="200" height="80" class="result"/>
  <text x="580" y="350" text-anchor="middle" class="result-title">Behavior</text>
  <text x="580" y="370" text-anchor="middle" class="code-muted">False:</text>
  <text x="580" y="384" text-anchor="middle" class="code">undef  ""  0  "0"</text>
  <text x="580" y="400" text-anchor="middle" class="code-muted">True:</text>
  <text x="580" y="414" text-anchor="middle" class="code">everything else</text>

  <!-- Bottom summary line -->
  <line x1="60" y1="440" x2="660" y2="440" stroke="#009485" stroke-width="1" opacity="0.3"/>
  <text x="360" y="460" text-anchor="middle" class="label" style="font-style: italic;">Context is determined by the surrounding code, not by the value itself.</text>
</svg>
