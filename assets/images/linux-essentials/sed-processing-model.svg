<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 420" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrow-light" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#9e9e9e"/>
    </marker>
    <marker id="arrow-dark" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#666"/>
    </marker>
  </defs>
  <style>
    .title { font-size: 11px; font-weight: 600; fill: #1a1a1a; }
    .label { font-size: 10px; fill: #555; }
    .code { font-size: 10px; fill: #1a1a1a; font-family: "SFMono-Regular", "Consolas", "Liberation Mono", monospace; }
    .box { fill: #f5f5f5; stroke: #ccc; stroke-width: 1; rx: 8; }
    .box-accent { fill: #f5f5f5; stroke: #009485; stroke-width: 1.5; rx: 8; }
    .diamond { fill: #f5f5f5; stroke: #ccc; stroke-width: 1; }
    .connector { stroke: #9e9e9e; stroke-width: 1.2; fill: none; marker-end: url(#arrow-light); }
    .heading { font-size: 13px; font-weight: 700; fill: #009485; }

    @media (prefers-color-scheme: dark) {
      .title { fill: #e0e0e0; }
      .label { fill: #aaa; }
      .code { fill: #e0e0e0; }
      .box { fill: rgba(255,255,255,0.07); stroke: rgba(255,255,255,0.15); }
      .box-accent { fill: rgba(255,255,255,0.07); stroke: #4db6ac; }
      .diamond { fill: rgba(255,255,255,0.07); stroke: rgba(255,255,255,0.15); }
      .connector { stroke: #666; marker-end: url(#arrow-dark); }
      .heading { fill: #4db6ac; }
    }
  </style>

  <!-- Heading -->
  <text x="300" y="24" text-anchor="middle" class="heading">sed Processing Model</text>

  <!-- 1. Read Line (accent box, top center) -->
  <rect x="225" y="44" width="150" height="40" class="box-accent"/>
  <text x="300" y="69" text-anchor="middle" class="title">Read Line</text>

  <!-- Arrow: Read Line -> Pattern Space -->
  <line x1="300" y1="84" x2="300" y2="104" class="connector"/>

  <!-- 2. Pattern Space -->
  <rect x="225" y="106" width="150" height="40" class="box"/>
  <text x="300" y="131" text-anchor="middle" class="title">Pattern Space</text>

  <!-- Arrow: Pattern Space -> Diamond -->
  <line x1="300" y1="146" x2="300" y2="170" class="connector"/>

  <!-- 3. Diamond: Match Address? -->
  <polygon points="300,172 400,207 300,242 200,207" class="diamond"/>
  <text x="300" y="204" text-anchor="middle" class="title">Match</text>
  <text x="300" y="216" text-anchor="middle" class="title">Address?</text>

  <!-- Yes branch: Diamond right -> Apply Command -->
  <line x1="400" y1="207" x2="468" y2="207" class="connector"/>
  <text x="430" y="199" text-anchor="middle" class="label">Yes</text>

  <!-- 4a. Apply Command (right) -->
  <rect x="470" y="187" width="120" height="40" class="box-accent"/>
  <text x="530" y="212" text-anchor="middle" class="title">Apply Command</text>

  <!-- No branch: Diamond left -> Pass Through -->
  <line x1="200" y1="207" x2="130" y2="207" class="connector"/>
  <text x="170" y="199" text-anchor="middle" class="label">No</text>

  <!-- 4b. Pass Through (left) -->
  <rect x="10" y="187" width="120" height="40" class="box"/>
  <text x="70" y="212" text-anchor="middle" class="title">Pass Through</text>

  <!-- Arrow: Apply Command down to merge point -->
  <path d="M 530 227 L 530 280 L 308 280" class="connector"/>

  <!-- Arrow: Pass Through down to merge point -->
  <path d="M 70 227 L 70 280 L 290 280" class="connector"/>

  <!-- 5. Output -->
  <rect x="225" y="260" width="150" height="40" class="box"/>
  <text x="300" y="285" text-anchor="middle" class="title">Output</text>

  <!-- Arrow: Output -> Next Line -->
  <line x1="300" y1="300" x2="300" y2="330" class="connector"/>

  <!-- 6. Next Line -->
  <rect x="225" y="332" width="150" height="40" class="box"/>
  <text x="300" y="357" text-anchor="middle" class="title">Next Line</text>

  <!-- 7. Loop back: Next Line -> Read Line -->
  <path d="M 225 352 L 140 352 L 140 64 L 223 64" class="connector"/>
  <text x="128" y="212" text-anchor="end" class="label">repeat</text>
</svg>
